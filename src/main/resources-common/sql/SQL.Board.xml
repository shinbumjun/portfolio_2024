<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.lhs.dao.BoardDao">

	<!-- 
		1. 모든 리스트  
		public BoardDto list(BoardDto boardDto); 
		
		(브라우저에 출력될 데이터) 번호, 제목, 글쓴이, 조회수, 첨부파일, 작성일 (조건 type_seq=2)
		
		startRow 시작, pageSize 페이지 사이즈
	-->
	<select id="list" parameterType="map" resultType="BoardDto">
	    SELECT board_seq, title, member_id, hits, has_file, create_dtm
		FROM S_shinbumjun.board
		WHERE type_seq = #{typeSeq}
		ORDER BY board_seq desc
    	LIMIT #{startRow}, #{pageSize};
	</select>
		
	<!-- 
		총 페이지 수를 가져오기 위해서 작성 (수정)
		총 게시글 수를 가져와 보기
		public int getTotalCount(PagingDto pagingDto);
		
		
		count(*) : 5166
		ROUND(count(*)/10) : 517
	 -->	
	 <select id="getTotalCount" parameterType="pagingDto" resultType="int">
	 	select count(*)
		from S_shinbumjun.board;
	 </select>
	 
		
	<select id="getTotalArticleCnt" parameterType="HashMap" resultType="int">
	
	</select>
	
	<!-- 
		3. 자유 게시판 업로드
		public int write(BoardDto boardDto);
		{memberNick=, is_ajax=true, memberIdx=, action=contact_send, title=신범준 제목, content=신범준 내용, memberId=sinbumjun, typeSeq=2, boardSeq=9}
		useGeneratedKeys="true" keyProperty="boardSeq"  : 글 번호
	-->
	<insert id ="write" parameterType="boardDto" useGeneratedKeys="true" keyProperty="boardSeq" >
		INSERT INTO S_shinbumjun.board
	    	(type_seq, member_id, member_nick, title, content, has_file, hits, create_dtm, update_dtm)
	    VALUES
	    	(#{typeSeq}, #{memberId}, #{memberNick}, #{title}, #{content}, NULL, 0, DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'), DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'))
	</insert>
	
	<select id="read" parameterType="HashMap" resultType = "HashMap">
	</select>

	<update id="updateHits" parameterType="HashMap" >
	</update>

	<update id="update" parameterType="HashMap">
	
	</update>
	
	<update id="updateHasFileToZero" parameterType="HashMap" >
	 	 
	 </update>
	
	<delete id="delete" parameterType="HashMap">
		
	</delete>

	<!-- 
		 fakename 만든것 업로드
		 public int addAttFile(HashMap<String, Object> map); 
		 
		 map.put("Type", mFile.getContentType());
		 map.put("Filename", mFile.getOriginalFilename());
		 map.put("Name", mFile.getName());
		 map.put("Size", mFile.getSize());
	-->
	<insert id="addAttFile" parameterType="HashMap">
	    INSERT INTO S_shinbumjun.board_attach
	    (type_seq, board_seq, file_name, fake_filename, file_size, file_type, save_loc, create_dtm)
	    VALUES
	    (2, 2, #{Filename}, #{fakename}, #{Size}, #{Type}, '', DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'))
	</insert>

</mapper>




